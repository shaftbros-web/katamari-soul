
<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Attach-Attack — モバイル見下ろしアクション v1.1</title>
  <style>
    :root{ --bg:#0a0f16; --ink:#e6edf3; --muted:#9aa4b2; --accent:#60a5fa; --danger:#ef4444; --ok:#22c55e; --panel:#0f172a; }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif; }
    #wrap{ display:grid; grid-template-rows:auto 1fr; height:100%; }
    header{ padding:8px 12px; background:var(--panel); border-bottom:1px solid #1f2937; display:flex; align-items:center; gap:12px; }
    header h1{ font-size:16px; margin:0; font-weight:700; letter-spacing:0.2px; }
    header .sub{ color:var(--muted); font-size:12px; }
    #game{ position:relative; height:100%; }
    canvas{ width:100%; height:100%; touch-action:none; display:block; background:#060910; }
    #hud{ position:absolute; inset:0; pointer-events:none; }
    .btn{ position:absolute; bottom:16px; left:16px; width:84px; height:84px; border-radius:50%; background:#111826aa; border:1px solid #273244; color:#cbd5e1; display:grid; place-items:center; font-weight:700; pointer-events:auto; user-select:none; }
    .joy{ position:absolute; right:16px; bottom:16px; width:140px; height:140px; pointer-events:auto; }
    .joy .base{ position:absolute; inset:0; border-radius:50%; background:#0b1220aa; border:1px solid #273244; }
    .joy .stick{ position:absolute; left:50%; top:50%; width:72px; height:72px; margin-left:-36px; margin-top:-36px; border-radius:50%; background:#1f2937cc; border:1px solid #334155; }
    #overlay{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:auto; background:#0a0f16f0; }
    .panel{ background:#0b1220cc; border:1px solid #273244; padding:24px 20px; border-radius:16px; min-width:300px; text-align:center; box-shadow:0 10px 40px #0008; }
    .panel h2{ margin:0 0 8px; font-size:22px; }
    .panel p{ margin:0 0 12px; color:var(--muted); font-size:14px; }
    .panel button{ appearance:none; background:var(--accent); color:#081018; border:0; padding:10px 16px; border-radius:999px; font-weight:700; margin-top:12px; }
    .slider-box{ margin:10px 0; text-align:left; font-size:13px; }
    .slider-box label{ display:block; margin-bottom:4px; }
    .slider-box input{ width:100%; }
  </style>
</head>
<body>
  <div id="wrap">
    <header>
      <h1>Attach-Attack</h1>
      <div class="sub">スマホ用見下ろしアクション — アイテムを本体に〈くっつけて〉攻撃</div>
    </header>
    <div id="game">
      <canvas id="cv" width="1280" height="720"></canvas>
      <div id="hud">
        <div class="bar" id="lifebar"><div class="fill"></div><div class="txt">LIFE</div></div>
      </div>
      <div class="joy" id="joy">
        <div class="base"></div>
        <div class="stick" id="stick"></div>
      </div>
      <button class="btn" id="actBtn">PICK</button>
      <div id="overlay">
        <div class="panel" id="panel">
          <h2>Attach-Attack</h2>
          <p>落ちているアイテムを拾って本体にくっつけ、さらにアイテム同士も連結させて強力に！<br>アイテムは耐久値が減ると小さくなり、ゼロで壊れます。<br>敵はザコ3種・中ボス・ボス。ボスを倒すとクリアです。</p>
          <div class="slider-box">
            <label for="playerLife">初期ライフ</label>
            <input type="range" id="playerLife" min="50" max="200" value="100">
          </div>
          <div class="slider-box">
            <label for="enemyCount">初期ザコ数</label>
            <input type="range" id="enemyCount" min="5" max="30" value="12">
          </div>
          <button id="startBtn">ゲーム開始</button>
        </div>
      </div>
    </div>
  </div>  <script>
  // Utility
  const rand=(a,b)=>Math.random()*(b-a)+a;
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const dist=(x1,y1,x2,y2)=>Math.hypot(x2-x1,y2-y1);
  const now=()=>performance.now();

  const cv=document.getElementById('cv');
  const ctx=cv.getContext('2d');
  function resize(){
    const dpr=window.devicePixelRatio||1;
    cv.width=Math.round(cv.clientWidth*dpr); cv.height=Math.round(cv.clientHeight*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  new ResizeObserver(resize).observe(cv);
  resize();

  const joy=document.getElementById('joy');
  const stick=document.getElementById('stick');
  let joyAct=false, joyDX=0, joyDY=0;
  function joyHandle(e){
    const rect=joy.getBoundingClientRect();
    const p=(e.touches? e.touches[0]:e);
    const x=p.clientX-rect.left-rect.width/2; const y=p.clientY-rect.top-rect.height/2;
    const r=rect.width/2-8; const len=Math.hypot(x,y); const s=len>r? r/len:1;
    joyDX=(x*s)/r; joyDY=(y*s)/r; stick.style.transform=`translate(${joyDX*r}px, ${joyDY*r}px)`;
  }
  joy.addEventListener('pointerdown',e=>{ joyAct=true; joy.setPointerCapture(e.pointerId); joyHandle(e); });
  joy.addEventListener('pointermove',e=>{ if(joyAct) joyHandle(e); });
  joy.addEventListener('pointerup',e=>{ joyAct=false; joyDX=joyDY=0; stick.style.transform='translate(0,0)'; });

  const STATE={ TITLE:0, PLAY:1, OVER:2, CLEAR:3 };
  let state=STATE.TITLE;
  const world={ w:2000, h:1200 };
  const cam={ x:0, y:0, shake:0 };

  const player={ x:world.w/2, y:world.h/2, r:18, speed:220, life:100, maxLife:100, dir:0, inv:0, items:[] };

  function makeItem(x,y){
    const size=rand(36,60); // bigger base size
    const max=rand(40,100);
    return { id:crypto.randomUUID(), x,y, size, maxDur:max, dur:max, attached:false, angle:rand(0,Math.PI*2), off:rand(28,50), children:[] };
  }
  const items=[];

  function attachItem(base,newItem){
    newItem.attached=true;
    base.children.push(newItem);
  }

  // Example: attach detection
  function updateAttachment(){
    for(const base of player.items){
      for(const it of items){ if(it.attached) continue; if(dist(base.x,base.y,it.x,it.y)<base.size){ attachItem(base,it); player.items.push(it);} }
    }
  }

  function drawItem(it){
    const scale = clamp(it.dur/it.maxDur,0,1);
    const s = it.size; // fixed actual size
    ctx.save(); ctx.translate(it.x,it.y); ctx.rotate(it.angle);
    ctx.fillStyle= it.attached? '#86efac':'#34d399';
    ctx.beginPath(); ctx.arc(0,0,s*0.5,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }

  function showTitle(){
    document.getElementById('overlay').style.display='grid';
  }
  document.getElementById('startBtn').addEventListener('click',()=>{
    player.maxLife=parseInt(document.getElementById('playerLife').value);
    player.life=player.maxLife;
    startGame();
  });

  function startGame(){
    items.length=0; for(let i=0;i<20;i++) items.push(makeItem(rand(80,world.w-80), rand(80,world.h-80)));
    state=STATE.PLAY; document.getElementById('overlay').style.display='none';
  }
  showTitle();
  </script></body>
</html>
